<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      tal:define="skills view/skills;
                  current_properties view/current_properties|nothing;
                  current_id current_properties/id|nothing;
                  current_cteam current_properties/cteam|nothing;
                  current_fullname current_properties/fullname|nothing;
                  expertise python:'';
                  exp_group python:'';
                  skills_count python:len(skills);
                  empty_count python:0;
                  update_count python:0;"
      i18n:domain="plone">

<head>
    <metal:block fill-slot="top_slot"
                 tal:define="dummy python:request.set('disable_border',1);
                             disable_column_one python:request.set('disable_plone.leftcolumn',1);
                             disable_column_two python:request.set('disable_plone.rightcolumn',1);" />
</head>

<body>
<metal:content-core fill-slot="content-core">
  <metal:content-core define-macro="content-core">
    <style>
      <metal:style use-macro="view/context/@@knowledge-utils/style"/>
      <metal:profile use-macro="view/context/@@knowledge-utils/profile"/>
    </style>

    <div class="table-wrap" i18n:domain="vs.knowledge">
      <metal:links use-macro="view/context/@@knowledge-utils/links"/>

      <table class="knowledge profile">
        <thead>
          <tr>
            <th i18n:translate="">Expertise</th>
            <th i18n:translate="">Subgroup</th>
            <th i18n:translate="">Name</th>
            <th i18n:translate="">Searchterms</th>
            <th tal:content="current_fullname">
              <span tal:content="python:member.getProperty('fullname')">
              Fullname
              </span>
            </th>
          </tr>
        </thead>
        <tbody>
          <tal:skill repeat="skill skills">
            <tr tal:define="group skill/group|nothing;
                            expertise_group python:group.split('|');
                            xp python:expertise_group[0] if len(expertise_group) == 2 else '';
                            gr python:expertise_group[1] if len(expertise_group) == 2 else '';
                            mls skill/member_level_show|nothing; 
                            data python:dict([(x.split('|')[0], x.split('|')[1]) for x in mls if len(x.split('|')) == 3]);
                            value python:data.get(current_id, False);
                            x_val python:value == 'X';
                            e_val python:value == False;"
                tal:attributes="class python:x_val and 'update' or e_val and 'empty' or None;">
              <tal:e condition="e_val"><tal:empty  define="global empty_count python:empty_count + 1"/></tal:e>
              <tal:x condition="x_val"><tal:update  define="global update_count python:update_count + 1"/></tal:x>
              <th tal:define="show python:expertise != xp"
                  tal:attributes="class python:'mark' if show else None;"
                  tal:content="python:xp if show else ''">Expertise</th>
              <tal:expertise define="global expertise xp"/>
              <th tal:define="show python:exp_group != gr"
                  tal:attributes="class python:'mark' if show else None;"
                  tal:content="python:gr if show else ''">Group</th>
              <tal:exp_group define="global exp_group gr"/>
              <th tal:content="skill/title|nothing">Name</th>
              <th tal:content="skill/description|nothing"></th>
              <td>
                <a tal:content="python:x_val and 'edit' or e_val and 'fill' or 'edit'"
                   tal:attributes="href skill/absolute_url"></a>
                <tal:value content="python:value if value else ''">X</tal:value>
              </td>
            </tr>
          </tal:skill>
        </tbody>
      </table>

      <metal:actions use-macro="view/context/@@knowledge-utils/actions"/>
    </div>
  </metal:content-core>
</metal:content-core>
</body>
</html>
